{% extends "pages/shared/base.html" %}

{% from "components/ui/alert.html" import alert %}

{% from "components/ui/field.html" import
  render_text_field,
  render_select_field,
  render_textarea_field
%}

{% block title %}Kalts Daniil - Contact Me{% endblock %}
{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<div x-data="{ count: {{ messages|length }} }" x-show="count > 0" class="mb-6">
  {% for category, message in messages %}
    {{ alert(category, message) }}
  {% endfor %}
</div>
{% endif %}
{% endwith %}

<div class="w-full md:max-w-4xl md:mx-auto">
  <div
    class="flex flex-col md:flex-row md:gap-4 bg-white dark:bg-gray-800 rounded-2xl shadow overflow-hidden"
  >
    <div class="hidden md:flex relative w-[45%] items-stretch overflow-hidden">
      <div class="relative w-full flex-1 overflow-hidden">
        <img
          class="w-full h-full object-cover object-top scale-110"
          src="{{ url_for('static', filename='images/covers/blog_author.jpg') }}"
          alt="Contact Cover"
        />
      </div>
    </div>
    <div class="w-full p-6 md:w-[55%]">
      <form
        x-data="{ submitting: false, submit_text: '{{ form.submit.label.text }}' }"
        x-on:submit="submitting = true"
        method="POST"
        action="{{ url_for('contact.contact') }}"
      >
        {{ form.hidden_tag() }}
        <div class="grid grid-cols-1 gap-5 sm:grid-cols-2">
          <div>{{ render_text_field(form.first_name) }}</div>
          <div>{{ render_text_field(form.last_name) }}</div>
          <div class="sm:col-span-2">
            {{ render_select_field(form.inquiry_type) }}
          </div>
          <div class="sm:col-span-2">{{ render_text_field(form.phone) }}</div>
          <div class="sm:col-span-2">
            {{ render_textarea_field(form.message) }}
          </div>
        </div>
        <div class="mt-6">
          <input
            :value="submitting ? 'Sending...' : submit_text"
            :disabled="submitting"
            :class="submitting ? 'bg-blue-300 opacity-50 cursor-not-allowed' : ''"
            type="submit"
            class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white text-sm px-6 py-2 rounded-lg font-medium focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  function scaleRecaptcha() {
    var container = document.querySelector(".recaptcha-container");
    if (!container) return;
    var recaptchaWidth = 302;
    var containerWidth = container.offsetWidth;
    var scale = containerWidth / recaptchaWidth;
    container.style.transform = "scale(" + scale + ")";
    container.style.transformOrigin = "0 0";
    container.style.height = 78 * scale + "px";
  }
  window.addEventListener("load", scaleRecaptcha);
  window.addEventListener("resize", scaleRecaptcha);
</script>
{% endblock %}
