{# templates/components/ui/post.html #}

{% macro render_post(post) %}
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
  {% if post.images and post.images|length > 0 %}
  <div
    x-data
    x-init="
      new Swiper($el, {
        loop: true,
        slidesPerView: 1,
        spaceBetween: 0,
        pagination: { el: $el.querySelector('.swiper-pagination'), clickable: true },
        navigation: {
          nextEl: $el.querySelector('.swiper-button-next'),
          prevEl: $el.querySelector('.swiper-button-prev')
        }
      })
    "
    class="swiper-container relative"
  >
    <div class="swiper-wrapper">
      {% for image in post.images %}
      <div class="swiper-slide">
        <img
          class="w-full h-[275px] sm:h-[325px] object-cover"
          src="{{ image.image_url }}"
        />
      </div>
      {% endfor %}
    </div>
    <div class="swiper-pagination"></div>
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
  </div>

  <div
    class="px-4 py-2 flex justify-between items-center border-b border-gray-200 dark:border-gray-700"
  >
    <div class="flex space-x-4">
      <button type="button" class="focus:outline-none" aria-label="Comment">
          <svg
            class="text-gray-900 dark:text-gray-100 w-[22px]"
            aria-label="Comment"
            fill="currentColor"
            height="24"
            role="img"
            viewBox="0 0 24 24"
            width="24"
          >
            <title>Comment</title>
            <path
              d="M20.656 17.008a9.993 9.993 0 1 0-3.59 3.615L22 22Z"
              fill="none"
              stroke="currentColor"
              stroke-linejoin="round"
              stroke-width="2"
            ></path>
          </svg>
      </button>
      <button type="button" class="focus:outline-none" aria-label="Share">
          <svg
            class="text-gray-900 dark:text-gray-100 w-[22px]"
            aria-label="Share"
            fill="currentColor"
            height="24"
            role="img"
            viewBox="0 0 24 24"
            width="24"
          >
            <title>Share</title>
            <line
              fill="none"
              stroke="currentColor"
              stroke-linejoin="round"
              stroke-width="2"
              x1="22"
              x2="9.218"
              y1="3"
              y2="10.083"
            ></line>
            <polygon
              fill="none"
              points="11.698 20.334 22 3.001 2 3.001 9.218 10.084 11.698 20.334"
              stroke="currentColor"
              stroke-linejoin="round"
              stroke-width="2"
            ></polygon>
          </svg>
      </button>
    </div>
    <button type="button" class="focus:outline-none" aria-label="Save">
      <svg
        class="text-gray-900 dark:text-gray-100 w-[22px]"
        aria-label="Save"
        fill="currentColor"
        height="24"
        role="img"
        viewBox="0 0 24 24"
        width="24"
      >
        <title>Save</title>
        <polygon
          fill="none"
          points="20 21 12 13.44 4 21 4 3 20 3 20 21"
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
        ></polygon>
      </svg>
    </button>
  </div>
  {% endif %}

  <div class="px-4 pb-4 pt-3">
    {% set words = post.content.split(' ') %} {% if words|length > 50 %}
    <div x-data="{ expanded: false }">
      <p class="text-sm text-gray-900 dark:text-gray-300">
        {% set excerpt = words[:50]|join(' ') %} {{ excerpt }}
        <span x-show="!expanded">
          <button
            @click="expanded = true"
            class="inline text-blue-600 dark:text-blue-400 text-sm hover:underline"
          >
            more
          </button>
        </span>
        <span x-show="expanded">
          {{ words[50:]|join(' ') }}
        </span>
      </p>
    </div>
    {% else %}
    <p class="text-sm text-gray-700 dark:text-gray-100">{{ post.content }}</p>
    {% endif %}
    <div class="mt-2 flex items-center justify-start">
      <span class="text-gray-500 text-xs"
        >{{ post.created_at.strftime("%b %d, %Y") }}</span
      >
    </div>
  </div>
</div>
{% endmacro %}
